<h1>Pet-project Финансовый дневник</h1>
<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSl9pRnJDzQV1lIeKuv8aPioTDi8E1nbRQv2w&usqp=CAU" alt="Финансовый дневник">
<p>Данный веб-сервис предназначен для отслеживания инвестиционного портфеля</p>

<p>В разделах сайта можно найти информацию о направлениях инвестирования, составе портфеля
а также различные графики стоимостей и возможность скачать отчёты</p>

<p>Далее будет подробно описано содержимое сайта и какие технологии для этого использовались</p>

<h2>Авторизация</h2>
<div>
<h3>Web авторизация</h3>
<p>Для авторизации использовался шаблон laravel php artisan ui:auth</p>
<p>В <a href="https://github.com/Kozavochka/Financal-diary/tree/ecdfc57af80b746f0951fbe3248a66cbb8cdb3ef/app/Http/Controllers/Auth">контроллерах авторизации</a> использовался стандартный middleware (guest), поэтому
маршруты доступны без авторизации</p>
<p>Далее в маршрутах используется middleware auth, который даёт доступ ко всем страницам,
которые доступны для гостей. Скачивание всех отчётов также лежит под auth.</p>
<p>Для администратора авторизация и вход такой же как и для обычного пользователя,
права администратору выдаются вручную в базе данных. Переход в админ панель находится
под middleware 'admin.panel', а ссылка под <a href="https://github.com/Kozavochka/Financal-diary/blob/develop/app/Policies/AdminPolicy.php">Policy</a></p>
<p>Посмотреть все используемые middleware можно в <a href="https://github.com/Kozavochka/Financal-diary/blob/bd271dc47d2cdebb454858e1f15937abd6c96a9a/app/Http/Kernel.php">HTTP/Kernel</a></p>

<h4>Интеграция с Тelegram</h4>
<p>Подробнее об использовании и настройки ТГ ботов будет описано ниже</p>
<p>При <b>регистрации пользователя</b> создаётся событие, в котором вызываются необходимые методы
для отправки мне(админу) почты и имени зарегистрированного пользователя.
</p>
<p>Также реализовано <b>восстановления пароля</b> пользователя. Для этого ему нужно запустить диалог с Telegram ботом.
При восстановлении пароля в чат к боту придёт код, с помощью которого можно будет сделать новый пароль</p>

<h3>API авторизация</h3>
<p>Также реализована регистрация и авторизация с помощью JWT токена, используя "php-open-source-saver/jwt-auth"</p>
<p>В API/Admin/AuthController реализованы необходимые методы и получение токена.
Создан open-api для аутентификации, api остался для зарегистрированных пользователей. 
Настройка jwt, включая время жизни токена, находится в jwt.php</p>
<p>Для пользователей api создан JwtMiddleware, который проверяет jwt токен, а для админа AdminApiMiddleware,где проверяется роль пользователя</p>

</div>

<h2>Состав портфеля</h2>
<div>
<h3>Модели</h3>
<p>В прокете используется такие типы активов как:</p>
<ul>
<li>Акции</li>
<li>Облигации</li>
<li>Фонды</li>
<li>Займы</li>
<li>Криптовалюта</li>
</ul>
<p>Для каждого типа активов созданы соответствующие модели с необходимыми
зависимости для отношений и fillable. У всех активов, кроме криптовалюты, указана
стоимость в рублях</p>
<p>Также есть дополнительные модели такие как:</p>
<ul>
    <li>Тип поступления - IncomeType</li>
    <li>Поступления - Income. Подразумевают информацию о приходящем кеше и его типе</li>
    <li>Отрасли. Для акций</li>
    <li>Отслеживание - Record</li>
</ul>
<p>Так как изначально планировалось ручное отслеживание стоимости, то в таблица 
отслеживаний содержит запись всех введённых стоимостей акций и их стоимость</p>

</div>

<h2>Eloquent</h2>
<div>
<p>Использовались контроллеры со стандартными CRUD методами. В контроллерах
производились необходимые запросы на получение соотв. активов, а также использовалась
пагинация по умолчанию.</p>
<p>В некоторых случаях, когда нужно было сделать несколько запросов, результат
помещался в переменную $data(пр. HomeController), которая уже передавалась в view
</p>
<h3>Фильтрация</h3>
<p>Для фильтрации использовалась библиотека <a href="https://spatie.be/docs/laravel-query-builder/v5/features/filtering">spatie</a>,
так как она удобно позволяет применять несколько фильтров одновременно</p>
<h2>Возможности гостя</h2>
<h3>Web</h3>
<p>Для авторизированного гостя доступна домашняя страница с общей информацией о составе
портфеля с графиком и возможностью скачать полный pdf отчёт. Также доступны
разделы со списком акций, где можно посмотреть все акции и информацию по каждой, 
также представлен график стоимости, таблица отраслей и возможность скачать Excel отчёт. 
Еще один доступный раздел - облигации, с общей информацией об облигациях в портфеле</p>
<h3>API</h3>
<p>По API доступна только информация об акциях с возможностью фильтрации по стоимости
и отрасли.</p>
</div>

<h2>Возможности админа</h2>
<div>
<p>Для админ панели использовался <a href="https://adminlte.io/">Admin LTE 3.2.0</a></p>
<p>Краткий функционал админа:</p>
<ul>
    <li>CRUD действия на все активы</li>
    <li>Обновление webhook для Telegram бота</li>
    <li>Запись поступлений</li>
    <li>Отслеживание стоимости активов</li>
    <li>Обновление цен с помощью API (через artisan команду на сервере)</li>
    <li>Получение информации о новых пользователях</li>
</ul>
<h3>CRUD</h3>
<p>Для админа созданы свои контроллеры с CRUD методами и стандартным функционалом
для них. Для страниц с отображением графиков производились необходимые действия с
коллекциями для получения названий и стоимостей. Подробнее о графиках .ниже.</p>
<h3>Webhook+addCommand Telegram</h3>
<p>На странице доступно обновление вебхука бота, предназначенного для пользователей, для этого нужно указать адрес в 
env WORKER_WEBHOOK_URL. После, при нажатии, установится webhook для бота и добавится( при необходимости)
новая команда (если новых команд не будет, добавление можно закомментировать)
Для получение url webhook использовался <a href="https://ngrok.com/">ngrok</a></p>
<h3>Поступления</h3>
<p>Админ также может записывать поступления в портфель, выбирая тип, сумму и возможность оставить комментарий. Без удаления и редактирования(лень)</p>
<h3>Отслеживание</h3>
<p>Для отслеживания стоимости акций использовалась дополнительная таблица отношения
многие - ко многим Stock`s - Record`s. В сводной таблице записывается id отслеживания и цена соответствующей акции.
В отслеживании можно посмотреть динамику изменения стоимости акции.</p>
<h3>Обновление цен по API</h3>
<p>Artisan команды представлены в app/Console/Commands.Методы команд в services/api/command.
Обновление происходит с помощью вызова соотв. php artisan ... команд</p>
<h4>Акции</h4>
<p>Для отслеживания цен акций, так как представлен только Российский рынок, использовалось
MOEX API. <a href="#">на api</a></p>
<h4>Крипта</h4>
<p>Для получения данных о крипторынке использовался сервис aplhavantage. Для
его использования нужен ключ, получаемый на их сайте</p>
</div>
TO BE CONTINUED
<h2>Отчёты PDF\Excel</h2>
..pdf отчёты, как составляются, что используется
..excel отчёты
<h2>Интеграция с ТГ</h2>
..где хранятся данные бота
..команды ботов
..оповещение админа при регистрации
..восстановление пароля
<h2>Интеграция с API фондовых и крипто рынков</h2>
..alpha
..moex
